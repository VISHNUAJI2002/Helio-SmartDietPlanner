{% extends "base.html" %}
{% block content %}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-5">
            <div class="card shadow-sm p-4" style="border-radius: 12px; border: none;">
                <h2 class="text-center text-success mb-4">Set a New Password</h2>
                <form method="POST" id="reset-form">
                    <div class="mb-3">
                        <label for="password" class="form-label">New Password</label>
                        <input type="password" class="form-control" id="password" name="password" required>
                    </div>
                    
                    <!-- NEW: Confirm Password Field -->
                    <div class="mb-3">
                        <label for="confirm_password" class="form-label">Confirm New Password</label>
                        <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
                    </div>

                    <!-- NEW: Show Password Checkbox -->
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="showPassword">
                        <label class="form-check-label" for="showPassword">Show Password</label>
                    </div>

                    <!-- NEW: Error Message Div -->
                    <div id="password-error" class="text-danger mb-3" style="font-size: 0.9em;"></div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-success btn-lg">Reset Password</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- NEW: JavaScript for validation and show password -->
<script>
document.addEventListener('DOMContentLoaded', function () {
    const resetForm = document.getElementById('reset-form');
    const passwordInput = document.getElementById('password');
    const confirmPasswordInput = document.getElementById('confirm_password');
    const showPasswordCheckbox = document.getElementById('showPassword');
    const passwordError = document.getElementById('password-error');

    // 1. Show/Hide Password functionality
    showPasswordCheckbox.addEventListener('change', function() {
        const type = this.checked ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        confirmPasswordInput.setAttribute('type', type);
    });

    // 2. Check for password match on form submit
    resetForm.addEventListener('submit', function(event) {
        // Clear any previous error
        passwordError.textContent = '';

        if (passwordInput.value !== confirmPasswordInput.value) {
            // Stop the form from submitting
            event.preventDefault();
            // Display an error message
            passwordError.textContent = 'Passwords do not match. Please try again.';
        }
        
        // Note: Your backend should also have password validation (length, etc.)
        // as a final security check, which it already does.
    });
});
</script>

{% endblock %}
